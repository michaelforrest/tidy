#!/usr/bin/env ruby
#
require 'rubygems'
require 'optparse'
require File.dirname(__FILE__) + '/../lib/tidy_project'

def fail_with(opts, message)
  puts "[ERROR] #{message}"
  puts ""
  puts opts
  exit
end

parser = OptionParser.new do |options|
  options.banner = <<-END
  
    Tidy is an ActionScript toolkit for people who love Ruby.
    See http://github.com/michaelforrest/tidy
    
    Creating a project:
      tidyflash new APP_PATH
      cd APP_PATH
      rake
          
    Development server:    
      tidyflash server [--bandwidth 400k]
          
  END
  
  options.separator ""
  
#  options.on("-v", "--verbose", "Show what it's doing") do
#    OPTIONS[:verbose] = true
#  end
  
  
end

if ARGV.length >= 1
  
  command = ARGV[0]
  if command == 'new'
    project_name = ARGV[1]
    unless project_name.nil?
      TidyProject.new(project_name)
    else
      fail_with "","Please provide a project name"
    end
  end
  
  if command == 'server'
    
  end
  
  if command == 'generate'
    template_name = ARGV[1]

    if template_name.nil?
      fail_with "", "Please provide a generator name"
    else
      ARGV -= [ARGV[1]]
      Tidy::Generate.new(:template_id=>template_name, :args=>ARGV)
    end
  end
  
else
  puts parser.banner
end